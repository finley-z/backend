<!DOCTYPE html>
<html lang="en">
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>字典管理</title>
    <style type="text/css">
        .pagination-panel .btn {
            color: #FFF !important;
            background-color: #217ebd !important;
            border-color: #1f78b5 !important;
        }

        .dictionary_title {
            padding: 5px 5px 10px 10px;
        }
    </style>
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
<div class="portlet light bordered">
    <div class="portlet-body">
        <div class="row">
            <!--字典类型-->
            <div class="col-md-6" style="border-right: 2px solid #d6d6d6">
                <div class="dictionary_title">
                    <span class="caption-subject font-green-sharp bold uppercase">字典类型</span>
                    <span style="float: right">
                        <a class="btn btn-sm green" data-toggle="modal" onclick="addDictionaryType()">新增字典类型
                            <i class="fa fa-plus"></i>
                        </a>
                    <a class="btn btn-sm yellow" data-toggle="modal" onclick="editDictionaryType()">编辑字典类型
                        <i class="fa fa-edit"></i>
                    </a>
                    </span>
                </div>
                <div class="table-scrollable">
                    <table class="table table-striped table-bordered  table-header-fixed table-hover table-checkable order-column dataTable no-footer "
                           id="dictionTypeTable" role="grid" aria-describedby="dictionTypeTable_info">
                        <thead>
                        <tr role="row">
                            <th rowspan="1" colspan="1" aria-label=" " style="width: 60px;">
                                <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                    <input type="checkbox" class="group-checkable"
                                           data-set="#dictionTypeTable.checkboxes">
                                    <span></span>
                                </label>
                            </th>
                            <th tabindex="0" aria-controls="dictionTypeTable" rowspan="1" colspan="1"
                                style="width: 120px;">类型名称
                            </th>
                            <th tabindex="0" aria-controls="dictionTypeTable" rowspan="1" colspan="1"
                                style="width: 50px;">助记码
                            </th>

                            <th tabindex="0" aria-controls="dictionTypeTable" rowspan="1" colspan="1"
                                style="width: 260px;">描述
                            </th>
                            <th tabindex="0" aria-controls="dictionTypeTable" rowspan="1" colspan="1"
                                style="width: 50px;">状态
                            </th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <!--字典-->
            <div class="col-md-6">
                <div class="dictionary_title">
                    <span class="caption-subject font-green-sharp bold uppercase">字典</span>
                    <span style="float: right">
                        <a class="btn btn-sm green" data-toggle="modal" onclick="addDictionary()">新增字典
                            <i class="fa fa-book"></i>
                        </a>
                        <a class="btn btn-sm yellow" data-toggle="modal" onclick="editDictionary()">编辑字典
                            <i class="fa fa-book"></i>
                        </a>
                    </span>
                </div>
                <div class="table-scrollable">
                    <table class="table table-striped table-bordered  table-header-fixed table-hover table-checkable order-column dataTable no-footer "
                           id="dictionTable" role="grid" aria-describedby="dictionTable_info">
                        <thead>
                        <tr role="row">
                            <th rowspan="1" colspan="1" aria-label=" " style="width: 60px;">
                                <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                    <input type="checkbox" class="group-checkable" data-set="#dictionTable.checkboxes">
                                    <span></span>
                                </label>
                            </th>
                            <th tabindex="0" aria-controls="dictionTable" rowspan="1" colspan="1" style="width: 80px;">
                                所属类型
                            </th>
                            <th tabindex="0" aria-controls="dictionTable" rowspan="1" colspan="1" style="width: 150px;">
                                字典名称
                            </th>
                            <th tabindex="0" aria-controls="dictionTable" rowspan="1" colspan="1" style="width: 260px;">
                                编码值
                            </th>
                            <th tabindex="0" aria-controls="dictionTable" rowspan="1" colspan="1" style="width: 50px;">
                                状态
                            </th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--字典类型新增弹出框-->
<div id="dictionaryTypeModal" class="modal fade" tabindex="-1" data-focus-on="input:first">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">
            <i class="icon-bubble font-green-sharp"></i>
            <span class="caption-subject font-green-sharp bold uppercase">字典类型编辑</span>
        </h4>
    </div>
    <form class="form-horizontal" role="form" id="dictionaryTypeForm">
        <div class="modal-body">
            <div class="portlet-body form">
                <div class="form-body">
                    <input type="hidden" name="typeId"/>

                    <div class="form-group">
                        <label class="col-md-3 control-label">类型名称</label>

                        <div class="col-md-9">
                            <div class="input-icon">
                                <i class="fa fa-bell-o"></i>
                                <input type="text" name="typeName" class="form-control" placeholder="类型名称">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-3 control-label">助记码</label>

                        <div class="col-md-9">
                            <div class="input-icon">
                                <i class="fa fa-bell-o"></i>
                                <input type="text" name="typeCode" class="form-control" placeholder="助记码">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-3 control-label">类型描述</label>

                        <div class="col-md-9">
                            <textarea class="form-control" rows="3" name="typeDesc"></textarea>

                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-3 control-label">状态</label>

                        <div class="col-md-9">
                            <select class="form-control" name="status">
                                <option value="1">正常</option>
                                <option value="0">禁用</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn default">取消</button>
            <button type="button" class="btn green m-icon" id="saveDictionaryType">保存</button>
        </div>
    </form>
</div>

<!--字典新增弹出框-->
<div id="dictionaryModal" class="modal fade" tabindex="-1" data-focus-on="input:first">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">
            <i class="icon-bubble font-green-sharp"></i>
            <span class="caption-subject font-green-sharp bold uppercase">字典管理</span>
        </h4>
    </div>
    <form class="form-horizontal" role="form" id="dictionaryForm">
        <div class="modal-body">
            <div class="portlet-body form">
                <div class="form-body">
                    <input type="hidden" name="dictionaryId"/>

                    <div class="form-group">
                        <label class="col-md-3 control-label">字典类型</label>

                        <div class="col-md-9">
                            <select id="typeId" class="form-control" name="typeId">
                                <option value="1">正常</option>
                                <option value="0">禁用</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-3 control-label">字典名称</label>

                        <div class="col-md-9">
                            <div class="input-icon">
                                <i class="fa fa-bell-o"></i>
                                <input type="text" name="value" class="form-control" placeholder="字典名称">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-3 control-label">编码值</label>

                        <div class="col-md-9">
                            <div class="input-icon">
                                <i class="fa fa-bell-o"></i>
                                <input type="text" name="key" class="form-control" placeholder="编码值">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-3 control-label">状态</label>

                        <div class="col-md-9">
                            <select class="form-control" name="status">
                                <option value="1">正常</option>
                                <option value="0">禁用</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn default">取消</button>
            <button type="button" class="btn green m-icon" id="saveDictionary">保存</button>
        </div>
    </form>
</div>

<script type="text/javascript">
    var dictionTypeTable;
    var dictionTable;
    $(function () {
        var a = 0;
        App.getViewPort().width < App.getResponsiveBreakpoint("md") ? $(".page-header").hasClass("page-header-fixed-mobile") && (a = $(".page-header").outerHeight(!0)) : $(".page-header").hasClass("navbar-fixed-top") ? a = $(".page-header").outerHeight(!0) : $("body").hasClass("page-header-fixed") && (a = 64);

        //字典类型
        dictionTypeTable = $("#dictionTypeTable").DataTable({
            ajax: {
                "url": "${ctx}/dictionary/dictionaryTypeList",
                "type": "POST",
                "data": function (d) {
                    d.page = $("#dictionTypeTable").DataTable().page() + 1;
                    var row = $("select[name='dictionTypeTable_length']").val();
                    d.rows = row == undefined ? 0 : row;
                }
            },
            "bProcessing": true,
            "bStateSave": !0,
            "lengthMenu": [10, 15, 20],
            "lengthChange": true,
            "pageLength": 10,
            "pagingType": "bootstrap_extended",
//            "select": 'single',
            "fixedHeader": {"header": !0, "headerOffset": a},
            "ordering": false,
            "bInfo": true,
            "serverSide": true,
            "searching": false,
            "columns": [
                {
                    "data": "typeId", "render": function (data, type, full, meta) {
                    return "<label class='mt-checkbox mt-checkbox-single mt-checkbox-outline'>" +
                            "<input type='checkbox' class='checkboxes' value='" + data + "' /><span></span></label>";
                }
                },
                {"data": "typeName"},
                {"data": "typeCode"},
                {"data": "typeDesc"},
                {
                    "data": "status", "render": function (data, type, full, meta) {
                    var label;
                    if (data == 1) {
                        label = "<span class='label label label-success'>正常</span>";
                    }
                    if (data == 0) {
                        label = "<span class='label label label-danger'>禁用</span>";
                    }
                    return label;
                }
                }
            ],
            "dom": 'rt<"bottom"lp<"clear">>',
            "language": {
                aria: {
                    sortAscending: ": activate to sort column ascending",
                    sortDescending: ": activate to sort column descending"
                },
                emptyTable: "暂无记录",
                infoEmpty: "暂无记录",
                lengthMenu: "  _MENU_ ",

                zeroRecords: "暂无记录",
                paginate: {previous: "上一页", next: "下一页", last: "尾页", first: "首页", "page": "", "pageOf": ""}
            }
        });
        //字典
        dictionTable = $("#dictionTable").DataTable({
            ajax: {
                "url": "${ctx}/dictionary/dictionaryList",
                "type": "POST",
                "data": function (d) {
                    d.page = $("#dictionTable").DataTable().page() + 1;
                    var row = $("select[name='dictionTable_length']").val();
                    d.rows = row == undefined ? 0 : row;
                }
            },
            "bProcessing": true,
            "bStateSave": !0,
            "lengthMenu": [10, 15, 20],
            "lengthChange": true,
            "pageLength": 10,
            "pagingType": "bootstrap_extended",
//            "bSelect": 'single',
            "fixedHeader": {"header": !0, "headerOffset": a},
            "ordering": false,
            "bInfo": true,
            "serverSide": true,
            "searching": false,
            "columns": [
                {
                    "data": "dictionaryId", "render": function (data, type, full, meta) {
                    return "<label class='mt-checkbox mt-checkbox-single mt-checkbox-outline'>" +
                            "<input type='checkbox' class='checkboxes' value='" + data + "' /><span></span></label>";
                }
                },
                {"data": "typeName"},
                {"data": "value"},
                {"data": "key"},
                {
                    "data": "status", "render": function (data, type, full, meta) {
                    var label;
                    if (data == 1) {
                        label = "<span class='label label label-success'>正常</span>";
                    }
                    if (data == 0) {
                        label = "<span class='label label label-danger'>禁用</span>";
                    }
                    return label;
                }
                }
            ],
            "dom": 'rt<"bottom"lp<"clear">>',
            "language": {
                aria: {
                    sortAscending: ": activate to sort column ascending",
                    sortDescending: ": activate to sort column descending"
                },
                emptyTable: "暂无记录",
                infoEmpty: "暂无记录",
                lengthMenu: "  _MENU_ ",

                zeroRecords: "暂无记录",
                paginate: {previous: "上一页", next: "下一页", last: "尾页", first: "首页", "page": "", "pageOf": ""}
            }
        });

        $("#dictionTypeTable").on('check', ".checkboxes", function (event) {
            alert();
        })

        $("#saveDictionary").click(function () {
            var bv = $("#roleForm").data('bootstrapValidator');
            bv.validate();
            if (bv.isValid()) {
            $.ajax({
                url: "${ctx}/dictionary/saveDictionary",
                type: "post",
                data: $("#dictionaryForm").serialize(),
                success: function (data) {
                    data = eval(data);
                    if (data.status) {
                        $("#dictionaryModal").modal('hide');
                        Table.reload(dictionTable);
                        swal("Oops...", "保存成功!", "success");
                    } else {
                        $("#dictionaryModal").modal('hide');
                        swal("Oops...", "保存失败:" + data.errorMsg, "error");
                    }
                    return;
                },
                error: function () {
                    $("#dictionaryModal").modal('hide');
                    swal("Oops...", "保存出错:" + data.errorMsg, "error");
                    return;
                }
            })
            }
        })

        $("#saveDictionaryType").click(function () {
            var bv = $("#roleForm").data('bootstrapValidator');
            bv.validate();
            if (bv.isValid()) {
            $.ajax({
                url: "${ctx}/dictionary/saveDictionaryType",
                type: "post",
                data: $("#dictionaryTypeForm").serialize(),
                success: function (data) {
                    data = eval(data);
                    if (data.status) {
                        $("#dictionaryTypeModal").modal('hide');
                        Table.reload(dictionTypeTable);
                        swal("Oops...", "保存成功!", "success");
                    } else {
                        $("#dictionaryTypeModal").modal('hide');
                        swal("Oops...", "保存失败:" + data.errorMsg, "error");
                    }
                    return;
                },
                error: function () {
                    $("#dictionaryTypeModal").modal('hide');
                    swal("Oops...", "保存出错:" + data.errorMsg, "error");
                    return;
                }
            })
            }
        });
        Common.initSelector("${ctx}/dictionary/getTypeList","typeId","typeName","typeId");
    });


    function addDictionaryType() {
        Form.clear("dictionaryTypeForm");
        $("#dictionaryTypeModal").modal('show');
    }

    function addDictionary() {
        Form.clear("dictionaryForm");
        $("#dictionaryModal").modal('show');
    }


    function editDictionaryType() {
        var ids=Table.getSelectIds(dictionTypeTable);
        var length = ids.length;
        if (length != 1) {
            if (length < 1) {
                swal("Oops...", "请选择您需要编辑的记录！", "info");
            } else if (length > 1) {
                swal("Oops...", "一次只能编辑一条信息！", "info");
            }
            return;
        }
        $.ajax({
            url: "${ctx}/dictionary/getDictionaryType",
            type: "post",
            data: {typeId: ids[0]},
            success: function (data) {
                Form.load("dictionaryTypeForm", data);
            }
        })
        $("#dictionaryTypeModal").modal('show');
    }

    function editDictionary() {
        var ids=Table.getSelectIds(dictionTable);
        var length = ids.length;
        if (length != 1) {
            if (length < 1) {
                swal("Oops...", "请选择您需要编辑的记录！", "info");
            } else if (length > 1) {
                swal("Oops...", "一次只能编辑一条信息！", "info");
            }
            return;
        }
        $.ajax({
            url: "${ctx}/dictionary/getDictionary",
            type: "post",
            data: {dictionaryId: ids[0]},
            success: function (data) {
                Form.load("dictionaryForm", data);
            }
        })
        $("#dictionaryModal").modal('show');
    }

</script>
</body>

</html>